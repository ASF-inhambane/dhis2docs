<?xml version='1.0' encoding='UTF-8'?>
<!-- This document was created with Syntext Serna Free. --><!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN" "http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd" []>
<chapter>
	<title>Using Jasper iReport Designer</title>
	<section>
		<title>Background for Using Jasper iReport Designer</title>
		<para>
			Jasper iReport Designer is a tool for creating reports that can be used as Standard Reports [internal link?] in DHIS 2. The tool allows for the creation of standard report templates that can easily be exported from DHIS with up to date data. The process of creating reports involves four major steps. First, a report table must be created in DHIS 2 with the indicators to be used in the report. Secondly, a connection must be set up from iReport to the DHIS database. The layout of the report can then be made. Finally, the finished report can be uploaded to DHIS 2 to be used as a standard report. 
		</para>
	</section>

	<section>
		<title>Connecting iReport to the DHIS Database</title>

		<para>
			This section will explain how to connect iReport to the DHIS 2 database.
		</para>

		<para>
			Click the &quot;Report Datasource&quot; icon to start setting up the database connection.
		</para>
		<screenshot>
			<screeninfo>Click to open "Connections/Datasources" window</screeninfo>
			<mediaobject>
				<imageobject>
					<imagedata width="100%" fileref="resources/images/ireport/1_home.jpg" format="JPEG"/>
				</imageobject>
			</mediaobject>
		</screenshot>

		<para>
			Click &quot;New&quot;.
		</para>
		<screenshot>
			<screeninfo>Create a new database connection</screeninfo>
			<mediaobject>
				<imageobject>
					<imagedata width="66%" fileref="resources/images/ireport/2_new.jpg" format="JPEG"/>
				</imageobject>
			</mediaobject>
		</screenshot>

		<para>
			For datasource type, select &quot;Database JDBC connection&quot;, then click the &quot;Next&quot; button.
		</para>
		<screenshot>
			<screeninfo>Choose JDBC as datasource</screeninfo>
			<mediaobject>
				<imageobject>
					<imagedata width="66%" fileref="resources/images/ireport/3_driver.jpg" format="JPEG"/>
				</imageobject>
			</mediaobject>
		</screenshot>

		<para>
			In the next window, we need to enter information about the DHIS 2 database. First, provide a name for the connection. Most of the other information can be retrieved by entering DHIS 2, and opening the &quot;About&quot; page. Fill in the form as illustrated below, then click the &quot;Wiz&quot;-button so that the &quot;JDBC URL&quot; is updated.
		</para>
		<screenshot>
			<screeninfo>Fill in connection data from DHIS 2</screeninfo>
			<mediaobject>
				<imageobject>
					<imagedata width="100%" fileref="resources/images/ireport/4_dhis_info.jpg" format="JPEG"/>
				</imageobject>
			</mediaobject>
		</screenshot>

		<para>
			The next step is to fill in the password for the database user, check the &quot;Save Password&quot; checkbox, and hit &quot;Test&quot; to check if the connection is OK.
		</para>
		<screenshot>
			<screeninfo>Enter database user info</screeninfo>
			<mediaobject>
				<imageobject>
					<imagedata width="50%" fileref="resources/images/ireport/5_db_setup.jpg" format="JPEG"/>
				</imageobject>
			</mediaobject>
		</screenshot>

		<para>
			A window stating that the connection is OK should appear, otherwise control the data you have entered.
			<screenshot>
				<screeninfo>The connection is OK if this message appears</screeninfo>
				<mediaobject>
					<imageobject>
						<imagedata width="33%" fileref="resources/images/ireport/6_conn_test.jpg" format="JPEG"/>
					</imageobject>
				</mediaobject>
			</screenshot>
		</para>

		<para>
			Click &quot;OK&quot;, and save the connection data. The list of connections should now have the connection you just created listed. Close the window. 
			<screenshot>
				<screeninfo>Close the window if the new connection appears on the list</screeninfo>
				<mediaobject>
					<imageobject>
						<imagedata width="66%" fileref="resources/images/ireport/6_2_conn_list.jpg" format="JPEG"/>
					</imageobject>
				</mediaobject>
			</screenshot>
		</para>

	</section>


	<section>
		<title>Getting Information from the Database</title>

		<para>
			The next step is to perform a database query and fetch data from the Report Table we want to use in DHIS 2. To do this, we must create a new document to import this data into. Choose &quot;File&quot; from the top menu, and select &quot;New&quot;.
		</para>
		<screenshot>
			<screeninfo>Choose File -> New</screeninfo>
			<mediaobject>
				<imageobject>
					<imagedata width="50%" fileref="resources/images/ireport/7_new1.jpg" format="JPEG"/>
				</imageobject>
			</mediaobject>
		</screenshot>

		<para>
			A window will appear, where you can choose the template layout for the report. Select your desired format, then click &quot;Open this Template&quot;. 
		</para>
		<screenshot>
			<screeninfo>Select a template</screeninfo>
			<mediaobject>
				<imageobject>
					<imagedata width="100%" fileref="resources/images/ireport/8_new2.jpg" format="JPEG"/>
				</imageobject>
			</mediaobject>
		</screenshot>

		<para>
			Another window will now appear. Enter a filename for the report, and a location to save it to. After entering this information, click &quot;Next&quot; and &quot;Finish&quot;.
		</para>
		<screenshot>
			<screeninfo>Enter file name and location, then click next</screeninfo>
			<mediaobject>
				<imageobject>
					<imagedata width="66%" fileref="resources/images/ireport/9_new3.jpg" format="JPEG"/>
				</imageobject>
			</mediaobject>
		</screenshot>

		<para>
			We are now ready to fetch data from the Report Table in DHIS 2. We do this by right-clicking on the report name in the &quot;Report Inspector&quot; and selecting &quot;Edit Query&quot;.
		</para>
		<screenshot>
			<screeninfo>Right click on the report and choose Edit Query</screeninfo>
			<mediaobject>
				<imageobject>
					<imagedata width="50%" fileref="resources/images/ireport/10_edit_query.jpg" format="JPEG"/>
				</imageobject>
			</mediaobject>
		</screenshot>

		<para>
			In the &quot;Report Query&quot; window that appears, you now need to enter an SQL query from the database. To do this, you need to enter the name of the DHIS 2 Report Table you want to use. In the example below, we use the &quot;Outpatients&quot; table. Click on the "i" icon, and a box will appear. Make note of the "Table name".
		</para>
		<screenshot>
			<screeninfo>Find the name of the Report Table to use</screeninfo>
			<mediaobject>
				<imageobject>
					<imagedata width="100%" fileref="resources/images/ireport/10_2_rep_table_i.jpg" format="JPEG"/>
				</imageobject>
			</mediaobject>
		</screenshot>    

		<para>
			The statement we need to enter is on the form &quot;select * from [NAME OF TABLE]&quot;. In our example, the complete statement we enter is then &quot;select * from _report_outpatients&quot;. If the name of the report table contains a white space, it should be replaced with an underscore. As soon as we enter the name, the table at the bottom of the window is populated with data. Click &quot;OK&quot;.
		</para>
		<screenshot>
			<screeninfo>Enter the SQL query "select * from [table_name]"</screeninfo>
			<mediaobject>
				<imageobject>
					<imagedata width="100%" fileref="resources/images/ireport/12_sql_win.jpg" format="JPEG"/>
				</imageobject>
			</mediaobject>
		</screenshot>

		<para>
			If we look at the &quot;Report Inspector&quot; in iReport, under &quot;Fields&quot;, we see all the available column headings from the report table.
		</para>
		<screenshot>
			<screeninfo>Check that there are elements available in "Fields"</screeninfo>
			<mediaobject>
				<imageobject>
					<imagedata width="66%" fileref="resources/images/ireport/13_fields.jpg" format="JPEG"/>
				</imageobject>
			</mediaobject>
		</screenshot>

	</section>


	<section>
		<title>Creating and Editing a Report</title>

		<para>
			We are now ready to create the layout of the report. The main iReport windows consist of a &quot;Report Inspector&quot; to the left, the document in the middle, a &quot;Palette&quot; area on the upper right hand side and a &quot;Properties&quot; area on the lower right hand side. The &quot;Report Inspector&quot; are used for selecting and examining the various properties the document, and when selecting an item in the inspector, the &quot;Properties&quot; panel changes to display properties relating to the selection. The &quot;Palette&quot; is used for adding elements like text boxes, images and charts to the document.  
		</para>
		<screenshot>
			<screeninfo>Overview of the main iReport window</screeninfo>
			<mediaobject>
				<imageobject>
					<imagedata width="100%" fileref="resources/images/ireport/14_window.jpg" format="JPEG"/>
				</imageobject>
			</mediaobject>
		</screenshot>     


		<para>
			The iReport document is divided into seven main parts, divided by layout separators (the blue lines shown in the screenshot below). These lines are used to decide how big each of the areas should be on the report. 
		</para>
		<screenshot>
			<screeninfo>Page layout in iReport</screeninfo>
			<mediaobject>
				<imageobject>
					<imagedata width="100%" fileref="resources/images/ireport/14_window2.jpg" format="JPEG"/>
				</imageobject>
			</mediaobject>
		</screenshot>     


		<para>
			The areas all have different purposes:
		</para>
		<itemizedlist>
			<listitem>
				<para>
					Title - area for the title of the report
				</para>
			</listitem>
			<listitem>
				<para>
					Page header - area for the page header
				</para>
			</listitem>
			<listitem>
				<para>
					Column header - area for column headers (for the table)
				</para>
			</listitem>
			<listitem>
				<para>
					Detail 1 - area where the actual report data will be placed
				</para>
			</listitem>
			<listitem>
				<para>
					Column footer - area to make footer of the table
				</para>
			</listitem>
			<listitem>
				<para>
					Page footer - area for the page footer
				</para>
			</listitem>
			<listitem>
				<para>
					Summary - elements in this area will be placed at the end of the report
				</para>
			</listitem>
		</itemizedlist>

		<para>
			Data fields entered into the &quot;Detail 1&quot; area iterated over to create a table. For example, if a field called &quot;datalemenentname&quot; is placed in the &quot;Detailed&quot; area, all data elements in the report table will be listed here. To add the &quot;dataelementname&quot; field to the table, we simply drag it to the &quot;Detail 1&quot; area from the &quot;Report Inspector&quot;. The column header will be added automatically.
		</para>

		<para>
			Next, we may want to see what the report currently looks like. To do this, we click the &quot;Preview&quot; button. To get back to the editing tab later, click the &quot;Designer&quot; button. 
		</para>
		<screenshot>
			<screeninfo>Select the Preview button to get to the report preview</screeninfo>
			<mediaobject>
				<imageobject>
					<imagedata width="100%" fileref="resources/images/ireport/16_preview.jpg" format="JPEG"/>
				</imageobject>
			</mediaobject>
		</screenshot> 
		<screenshot>
			<screeninfo>The preview of the report</screeninfo>
			<mediaobject>
				<imageobject>
					<imagedata width="100%" fileref="resources/images/ireport/16_preview2.jpg" format="JPEG"/>
				</imageobject>
			</mediaobject>
		</screenshot>

		<para>
			As we can see from the preview above, it seems we need to adjust the height of the &quot;Detail 1&quot; area to remove some of the whitespace between each row. There are two ways to do this. The first way is to simply drag the blue layout-line as shown below.
		</para>
		<screenshot>
			<screeninfo>Drag the blue lines to change the size of layout areas</screeninfo>
			<mediaobject>
				<imageobject>
					<imagedata width="66%" fileref="resources/images/ireport/17_drag.jpg" format="JPEG"/>
				</imageobject>
			</mediaobject>
		</screenshot>

		<para>
			The other way to adjust the height of the row is to select the &quot;Detail 1&quot; element in the &quot;Report Inspector&quot;, and then adjust the &quot;Band height&quot; value in the &quot;Detail 1 - properties&quot; area in the lower right corner.
			<screenshot>
				<screeninfo>Adjust the size of layout areas by changing the Band height property</screeninfo>
				<mediaobject>
					<imageobject>
						<imagedata width="100%" fileref="resources/images/ireport/18_adjust.jpg" format="JPEG"/>
					</imageobject>
				</mediaobject>
			</screenshot>
		</para>

		<para>
			We can also give the column title a more informative name. To do this, simply double click on the text field and edit the name.
		</para>
		<screenshot>
			<screeninfo>Double click to edit text fields and text labels</screeninfo>
			<mediaobject>
				<imageobject>
					<imagedata width="66%" fileref="resources/images/ireport/19_edit_text.jpg" format="JPEG"/>
				</imageobject>
			</mediaobject>
		</screenshot>

		<para>
			Now, the table with data itself looks better. But we need to add a title. To do this, find the &quot;Static Text&quot; element in the &quot;Palette&quot;, and drag a text field onto the document.
		</para>
		<screenshot>
			<screeninfo>Add text by dragging the static text element to the report</screeninfo>
			<mediaobject>
				<imageobject>
					<imagedata width="100%" fileref="resources/images/ireport/20_title_add.jpg" format="JPEG"/>
				</imageobject>
			</mediaobject>
		</screenshot>

		<para>
			By double clicking the box, the text can be edited. The format of the text, such as size, font and alignment, can be adjusted with the tools above the document.
		</para>
		<screenshot>
			<screeninfo>Double click to edit the text, and change its appearance</screeninfo>
			<mediaobject>
				<imageobject>
					<imagedata width="100%" fileref="resources/images/ireport/21_title_edit.jpg" format="JPEG"/>
				</imageobject>
			</mediaobject>
		</screenshot>

	</section>


	<section>
		<title>Adding the Report to DHIS 2</title>

		<para>
			To use the report we have created as a Standard Report in DHIS 2, we must first prepare the file in iReport and then upload the file to DHIS 2.   
		</para>

		<para>
			The first step is to correct the expression language of the report to a format DHIS 2 understands. We do this by clicking on the report in the &quot;Report Inspector&quot;, and then changing the &quot;Language&quot; property to Java.
		</para>
		<screenshot>
			<screeninfo>Set report language to Java</screeninfo>
			<mediaobject>
				<imageobject>
					<imagedata width="100%" fileref="resources/images/ireport/22_language.jpg" format="JPEG"/>
				</imageobject>
			</mediaobject>
		</screenshot>

		<para>
			Next, we must change the file format of the report from .jrxml to .xml. We do this by selecting &quot;File -&gt; Save As...&quot; and simply replacing .jrxml with .xml in the file name. Then click &quot;Save&quot;.
		</para>
		<screenshot>
			<screeninfo>Choose Save As...</screeninfo>
			<mediaobject>
				<imageobject>
					<imagedata width="50%" fileref="resources/images/ireport/23_save_as.jpg" format="JPEG"/>
				</imageobject>
			</mediaobject>
		</screenshot>
		
		<screenshot>
			<screeninfo>Rename file to .xml format</screeninfo>
			<mediaobject>
				<imageobject>
					<imagedata width="50%" fileref="resources/images/ireport/24_save_as_xml.jpg" format="JPEG"/>
				</imageobject>
			</mediaobject>
		</screenshot>

		<para>
			We can now switch to DHIS 2 and import our report. Enter the Report Module in DHIS 2, and select &quot;Standard Report&quot;. In the &quot;Standard Report&quot; screen, click &quot;Add new&quot;.
		</para>
		<screenshot>
			<screeninfo>Navigate to Standard Report in DHIS 2</screeninfo>
			<mediaobject>
				<imageobject>
					<imagedata width="100%" fileref="resources/images/ireport/25_report.jpg" format="JPEG"/>
				</imageobject>
			</mediaobject>
		</screenshot>

		<screenshot>
			<screeninfo>Add a new Standard Report</screeninfo>
			<mediaobject>
				<imageobject>
					<imagedata width="66%" fileref="resources/images/ireport/26_add_new.jpg" format="JPEG"/>
				</imageobject>
			</mediaobject>
		</screenshot>

		<para>
			In the following screen, there are several actions we need to take. First, enter a name for the new &quot;Standard Report&quot;. Second, for design, click &quot;Choose File&quot; and find the .xml-file we created in iReport. Then, we select the report table that we used as a basis for the report in iReport. In our case, that was the &quot;Outpatient&quot; table. Click add, and it should move to the &quot;Selected report tables&quot; area. Finally, click save. 
		</para>
		<screenshot>
			<screeninfo>Upload the file and choose the right report table</screeninfo>
			<mediaobject>
				<imageobject>
					<imagedata width="66%" fileref="resources/images/ireport/27_new_std_report.jpg" format="JPEG"/>
				</imageobject>
			</mediaobject>
		</screenshot>

		<para>
			The report is now available as a &quot;Standard Report&quot; in DHIS 2.
		</para>
		<screenshot>
			<screeninfo>The report is available as a Standard Report</screeninfo>
			<mediaobject>
				<imageobject>
					<imagedata width="66%" fileref="resources/images/ireport/28_done.jpg" format="JPEG"/>
				</imageobject>
			</mediaobject>
		</screenshot>

	</section>


	<section>
		<title>Adding Charts</title>

		<para>
			It is possible to add charts to reports. In the example below, we will make a chart comparing the ANC Coverage among organisation units. We start by dragging a "Chart" element from the "Palette".
		</para>
		<screenshot>
			<screeninfo>Drag a Chart element to the report</screeninfo>
			<mediaobject>
				<imageobject>
					<imagedata width="66%" fileref="resources/images/ireport/29_addchart_1.jpg" format="JPEG"/>
				</imageobject>
			</mediaobject>
		</screenshot>

		<para>
			A new window appears where we can choose chart type. In this example, we use a regular bar chart. Click "OK", and then "Finish" on the next screen.
		</para>
		<screenshot>
			<screeninfo>Select a chart type</screeninfo>
			<mediaobject>
				<imageobject>
					<imagedata width="50%" fileref="resources/images/ireport/30_addchart_2.jpg" format="JPEG"/>
				</imageobject>
			</mediaobject>
		</screenshot>

		<screenshot>
			<screeninfo>Click Finish to end the wizard</screeninfo>
			<mediaobject>
				<imageobject>
					<imagedata width="66%" fileref="resources/images/ireport/31_addchart_3.jpg" format="JPEG"/>
				</imageobject>
			</mediaobject>
		</screenshot>

		<para>
			We have now added the chart, and can place it at the desired position on the screen. However, we have not yet added any data. To do this, we start by right clicking on the chart and selecting "Chart Data"
		</para>
		<screenshot>
			<screeninfo>Select Chart Data by right clicking on the chart</screeninfo>
			<mediaobject>
				<imageobject>
					<imagedata width="66%" fileref="resources/images/ireport/32_editchart_1.jpg" format="JPEG"/>
				</imageobject>
			</mediaobject>
		</screenshot>

		<para>
			Choose the "Details" tab, then click "Add".	
		</para>
		<screenshot>
			<screeninfo>Go the Details and Add a Category series</screeninfo>
			<mediaobject>
				<imageobject>
					<imagedata width="66%" fileref="resources/images/ireport/33_editchart_2.jpg" format="JPEG"/>
				</imageobject>
			</mediaobject>
		</screenshot>

		<para>
			A new window will appear, where we can add the actual data series. There are four fields that we can fill out, where the three first are mandatory.
		</para>
		<screenshot>
			<screeninfo>The Category series window</screeninfo>
			<mediaobject>
				<imageobject>
					<imagedata width="66%" fileref="resources/images/ireport/34_editchart_3.jpg" format="JPEG"/>
				</imageobject>
			</mediaobject>
		</screenshot>

		<itemizedlist>
			<title>[Explain - to do]</title>
			<listitem>
				<para>
					Series expression
				</para>
			</listitem>
			<listitem>
				<para>
					Category expression
				</para>
			</listitem>
			<listitem>
				<para>
					Value expression - the data values
				</para>
			</listitem>
		</itemizedlist>

		<para>
			In our example, we want to create a bar chart with organisation units along the category/x-axis, and the ANC coverage indicator along the value/y-axis. The "Series Expression" is not relevant for this, so we only put in an empty quote. To add the organisation units to the "Category expression", we click the edit-button. 
		</para>
		<screenshot>
			<screeninfo>Edit the category expression</screeninfo>
			<mediaobject>
				<imageobject>
					<imagedata width="66%" fileref="resources/images/ireport/35_editchart_4.jpg" format="JPEG"/>
				</imageobject>
			</mediaobject>
		</screenshot>

		<para>
			A new window appears with the available fields. We double click on "organisationunitname", which will automatically create the desired expression. Then click "Apply".
		</para>
		<screenshot>
			<screeninfo>Double click on the desired field</screeninfo>
			<mediaobject>
				<imageobject>
					<imagedata width="66%" fileref="resources/images/ireport/36_editchart_5.jpg" format="JPEG"/>
				</imageobject>
			</mediaobject>
		</screenshot>

		<para>
			We do the same for "Value expression", this time clicking on "anc_coverage_reporting_month" instead.
		</para>
		<screenshot>
			<screeninfo>Double click on the desired field</screeninfo>
			<mediaobject>
				<imageobject>
					<imagedata width="66%" fileref="resources/images/ireport/37_editchart_6.jpg" format="JPEG"/>
				</imageobject>
			</mediaobject>
		</screenshot>

		<para>
			Our table should now look like the one below, with all the required fields filled out. Click "OK" and then close the "Chart details" window.
		</para>
		<screenshot>
			<screeninfo>Close the window the the required expressions are filled</screeninfo>
			<mediaobject>
				<imageobject>
					<imagedata width="66%" fileref="resources/images/ireport/38_editchart_7.jpg" format="JPEG"/>
				</imageobject>
			</mediaobject>
		</screenshot>

		<para>
			Use "Preview" to check that the chart is displayed with the correct values.
		</para>

		<para>
			To make the chart more informative and better looking, with can select it by clicking once, and use the "Properties" panel make adjustments. For example, you can add a title to the chart, change the font, rotate the axis labels (as shown below) and so on.
		</para>
		<screenshot>
			<screeninfo>Edit the chart properties</screeninfo>
			<mediaobject>
				<imageobject>
					<imagedata width="100%" fileref="resources/images/ireport/39_editchart_9.jpg" format="JPEG"/>
				</imageobject>
			</mediaobject>
		</screenshot>

	</section>

</chapter>
