<?xml version='1.0' encoding='UTF-8'?>
<!-- This document was created with Syntext Serna Free. --><!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN" "http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd" []>
<chapter>
  <title>Using GIS</title>
  <section>
    <title>GIS module overview</title>
	<para>You can access the GIS module from the Services -&gt; GIS link in the top menu. The picture below shows the GIS viewport.</para>
	<screenshot>
      <screeninfo>Main GIS screen</screeninfo>
      <mediaobject>
        <imageobject>
          <imagedata width="100%" fileref="resources/images/gis/gis_main.png" format="PNG"/>
        </imageobject>
      </mediaobject>
    </screenshot>
    <para>On the right hand side there is a panel called "Map layers". There are three available "base layers", which means background map, including OpenStreetMap and Google Maps. You may click the text to open a context menu that lets you adjust the opacity/transparency of the background. "Overlays" are described later in this chapter. The final four layers are the vector layers which the user has at his disposal for thematic mapping. You may use this layer tree to show/hide layers by checking/uncheking their checkbox. The next panel called "Cursor position" tells you at what longitude and latitude your mouse cursor is positioned. The "Feature data" panel provides you with quick information on the organisation units you mouse hover in your thematic maps. Finally there is a legend panel for all the thematic layers.</para>
    <para>The picture below shows the map toolbar:</para>
    <para>The "Map" buttons from the left: "Zoom in", "Zoom out", "Zoom to visible extent" (all thematic map data fit inside the viewport).</para>
	<para>The "Layers" buttons from the left: "Thematic layer 1", "Thematic layer 2", "Facility layer", "Symbol layer".</para>
	<para>The "Tools" buttons from the left: "Favorite map views", "Predefines legend sets", "Export map to PNG", "Measure distances on map".</para>
	<para>The two final buttons are "Administrator settings" and "Help".</para>
	<screenshot>
        <screeninfo>Map toolbar</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="50%" fileref="resources/images/gis/gis_toolbar.png" format="PNG"/>
          </imageobject>
        </mediaobject>
	</screenshot>
  </section>
  <section>
    <title>Thematic mapping</title>
    <para>This section describes the four vector layers which the user has at his disposal for thematic mapping: "Thematic layer 1", "Thematic layer 2", "Facility layer" and "Symbol layer".</para>

    <section id="gisThematicMap">
      <title>Thematic layer 1 and 2</title>
      <screenshot>
        <screeninfo>Thematic mapping</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="100%" fileref="resources/images/gis/gis_thematic_mapping.png" format="PNG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
      <para>The two thematic layer panels let you use your data for thematic mapping. All you need to do is selecting your desired indicator/dataelement-period-map combination, then the organisation unit level and finally the parent to define the boundary. If your database has coordinates for these organisation units they will appear on the map.</para>
      <para>You may choose between legend types: <guimenuitem>automatic</guimenuitem> and <guimenuitem>predefined</guimenuitem>. Automatic means that the application will create a legend set for you based on your what method, number of classes, low color and high color you select. Method alludes to the size of the legend classes. Set to <guimenuitem>Equal intervals</guimenuitem> they will be “highest map value – lowest map value / number of classes”. Set to <guimenuitem>Equal group count</guimenuitem> the legend creator will try to distribute the organisation units evenly. Choose <guimenuitem>Fixed bounds </guimenuitem>and you may define your own class break values, type e.g. “20,40,60” using a comma to separate each of them. The legend will appear as an even gradation from the start color to the end color. Predefined legend sets are described in section 1.5.</para>
      <para>Low radius and high radius only have effect on points (facilities) and decides the the circle radius for points with the lowest and highest value.</para>
      <para>The map view combo box lists all map views (favorites) saved by the user. The settings that are stored in the map view is automatically applied to the thematic map panel. Favorite map views are described in section 1.4.</para>
      
      <para>All available layer options are now grouped together in the thematic layer menu, see picture below.</para>
      <screenshot>
        <screeninfo>Thematic layer options</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="50%" fileref="resources/images/gis/gis_thematic_layer_options.png" format="PNG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
      <para>Edit layer: Opens up the layer configuration window, see the thematic mapping screenshot.</para>
      <para>Refresh: Refreshes the map boundaries, data and legend. Usually not necessary.</para>
      <para>Clear: Clears the entire layer, i.e. the configuration window, the map and the legend panel.</para>
      <para>Filter: Opens up the filter window and lets you filter out organisation units from the map by value. See the picture below.</para>
      <screenshot>
        <screeninfo>Filter</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="50%" fileref="resources/images/gis/gis_filter.png" format="PNG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
      <para>Search: Opens up the search window and lets you search for and locate organisation units on the map. See picture below.</para>
      <screenshot>
        <screeninfo>Search</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="50%" fileref="resources/images/gis/gis_search.png" format="PNG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
      <para>Labels: Opens up the label window and lets you add labels to the organisation units on the map. See picture below.</para>
      <screenshot>
        <screeninfo>Labels</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="100%" fileref="resources/images/gis/gis_labels.png" format="PNG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
      <para>Opacity: Set the layer opacity/transparency to 10, 20, 30, 40, 50, 60, 70, 80, 90 or 100%.</para>
      <para>History: Provides you with a list of your 10 previous maps/selections. They are temporary and thus gone when the application is restarted.</para>
    </section>
    
    <section id="gisFacilityMap">
      <title>Facility layer</title>
      <para>This layer displays icons that represent facilities based on the facility type. Currently, "<guimenuitem>Type</guimenuitem>" is the only supported group set. Polygons will not show up on the map, so make sure to select a facility level. Click an icon on the map to open the context menu with two options. "Show information sheet" provides you with data for several data elements for this organisation unit. The data element group and period type are "system settings" called "Infrastructural data elements" and "Infrastructural period type". The second option in the context menu is "Relocate" and lets you graphically move the organisation unit to a different location. The new coordinate will be stored permanently.</para>
      <screenshot>
        <screeninfo>Facility layer</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="100%" fileref="resources/images/gis/gis_facility_layer.png" format="PNG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
    </section>
    
    <section id="gisSymbolMap">
      <title>Symbol layer</title>
      <para>This layer displays icons that represent areas/polygons like provinces, districts etc instead of facilities/points. Thus, in this layer you are not supposed to select a facility level, but instead a level of provinces, districts etc. In order to render this layer you need to create a predefined legend set of images, described in section 3.5.</para>
      <screenshot>
        <screeninfo>Symbol layer</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="100%" fileref="resources/images/gis/gis_symbol_layer.png" format="PNG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
    </section>
  </section>
  
  <section>
	<title>Tools</title>
	<para>This section describes the available GIS tools, see "Tools" on the map toolbar.</para>
	
	<section id="gisFavoriteMapView">
      <title>Register favorite map views</title>
      <para>Click the "Favorite map views" button (star icon) on the toolbar to get the context menu. The first option is "Manage favorites" which opens up a window where you are supposed to type the name of the favorite and select the layer you want to save. If you are an administrator you can check the "System" checkbox to make the favorite available to all users. From the bottom combobox you may delete a favorite or add it to the DHIS 2 dashboard.</para>
    </section>
	
	<section id="gisLegendSet">
      <title>Register legend sets</title>
      <para>Example usage (vaccination coverage): Firstly, create the legends that are going to constitute the legend set. The first one could be &quot;Low bad&quot; (display name), 0 (start value), 30 (end value), red (color). Then create &quot;Medium&quot; / 30 / 70 / yellow and finally &quot;High good&quot; / 70 / 100 / green. Now, open the &quot;legend set&quot; panel, type e.g. &quot;High is good&quot; as display name and select the desired legends below. Multi-select your three legends by pressing and holding the Ctrl/Shift button when selecting. Then click the register button to store the legend set. Assign indicators/data elements to your legend set in one of the two last panels. Select the legend set in the combo box and multi-select items in the list below. Click the assign button to update the legend set. Please see the referred window in section 1.1.</para>
    </section>
    
	<section id="gisImageExport">
      <title>Exporting/saving map images</title>
      <para>Click the image icon on the map toolbar and the  print window will open. Title: Image title, will appear as a headline in the image. Layers: Choose whether polygons, points or both will be printed. Width/Height: The pixel resolution of the image. Choose among the predefined &quot;small&quot; (800x600), &quot;medium&quot; (1190x880), &quot;large&quot; (1920x1200) or type the exact number of pixels yourself (type the number only, avoid text like &quot;px&quot;). If you want to exclude the legend from the image, untick the legend checkbox. Finally click the export button to print the image  (PNG). Please see the referred window in section 1.1.</para>
    </section>
    
    <section id="gisMeasureDistance">
      <title>Measure distance</title>
      <para>Click the two-way arrow icon on the map toolbar to enter measuring mode. Now, click your desired start location on the map and a dotted line will follow the cursor towards your destination. Single click to create a line point, double click to finish the line. To exit measuring mode, click the toolbar icon again or close the window.</para>
    </section>
  </section>

</chapter>
