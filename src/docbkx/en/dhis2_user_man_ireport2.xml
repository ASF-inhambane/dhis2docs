<?xml version='1.0' encoding='UTF-8'?>
<!-- This document was created with Syntext Serna Free. --><!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN" "http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd" []>
<chapter>
  <title>Advanced functions in iReport</title>
  <section>
    <title>Text</title>
    <para>
   There are two types of text in iReport: «Text labels» and «Text fields» (data fields). They work in different ways, and should be used for different purposes. The main point is that text fields are just placeholders that will be filled with the correct text from the report table when the report is run, while text labels will stay the way they are when the report is run.</para>
    <section>
      <title>Static text</title>
      <para>Static text are text plain text labels that can be edited normally. There are two ways to edit text labels: </para>
      <itemizedlist>
        <listitem>
          <para>By double clicking in the text box</para>
        </listitem>
        <listitem>
          <para>By using the Static text properties in the Properties panel</para>
        </listitem>
      </itemizedlist>
      <screenshot>
        <screeninfo>Click to edit text label</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="50%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_01.jpg" format="JPEG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
    </section>
    <section>
      <title>Text fields</title>
      <para>Text fields are formulas that will be filled from the report table when the report is run. Unlike static text, these can not be edited in a normal way. However, they can be manipulated in various ways to ensure that the desired output will be produced. There are three ways to edit the text fields:</para>
      <para/>
      <itemizedlist>
        <listitem>
          <para>By right clicking on the text box and selecting Edit expression</para>
        </listitem>
        <listitem>
          <para>By double clicking the text field (not recommended, as this will not bring up the expression editor)</para>
        </listitem>
        <listitem>
          <para>By using the Text field properties in the Properties panel</para>
        </listitem>
      </itemizedlist>
      <screenshot>
        <screeninfo>Click to open Expression editor</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="50%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_04.jpg" format="JPEG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
      <screenshot>
        <screeninfo>Click to open Expression editor</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="50%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_06.jpg" format="JPEG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
      <para>￼￼Text fields can represent either numbers or text, so that they can be used both for showing for example names of district or for numeric values. It is therefore important the the Expression class, seen in the Text field properties matches the Text field expression. For the default text fields in the .jrxml file downloaded from DHIS 2 this is not a problem, but it is important when making new text fields. The two most important Expression classes are java.lang.Double for numbers and java.lang.String for text.</para>
      <para/>
      <section>
        <title>Example</title>
        <para>For example, let us say you have a quarterly report where you would like to add a new column with the yearly total. You therefore add a new Static text field to the column header band, and a Text field to the details band in. By default, new Text fields are set to java.lang.String (text). However, the yearly total column will be filled with numbers. We therefore have to change the Expression class for the new text field to java.lang.Double:</para>
        <screenshot>
          <screeninfo>Click to show expression class options</screeninfo>
          <mediaobject>
            <imageobject>
              <imagedata width="50%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_07.jpg" format="JPEG"/>
            </imageobject>
          </mediaobject>
        </screenshot>
        <screenshot>
          <screeninfo>Choose desired class</screeninfo>
          <mediaobject>
            <imageobject>
              <imagedata width="50%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_08.jpg" format="JPEG"/>
            </imageobject>
          </mediaobject>
        </screenshot>
        <para>When we edit the text field expression, we see the Expression editor window with all the available columns from the report table. We can see here that each of these are marked with what type they are - text or number. What we need to make sure of is therefore that the expression class we choose for the text field matches the actual expression.</para>
        <screenshot>
          <screeninfo>Expression editor</screeninfo>
          <mediaobject>
            <imageobject>
              <imagedata width="90%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_10.jpg" format="JPEG"/>
            </imageobject>
          </mediaobject>
        </screenshot>
      </section>
    </section>
  </section>
  <section>
    <title>Filtering the table rows</title>
    <para>In the default table exported from DHIS 2, there are some rows that it might be better to leave out of the table, and some that it would be preferable to have at the end. For example, when making a table based on a report table with the «parent organisation unit» parameter, the default table might have a row with the national level somewhere in between all the regions. In iReport, this can be changed so that the «parent organisation unit» appears at the bottom of the table. This involves two steps that will be explained below. Note that this will not work where there is only one organisation units, and it is therefore most useful when using the «parent organisation unit» or «grand parent organisation unit» parameters in the report table.</para>
    <section>
      <title>Hiding the «parameter organisation unit» from the table</title>
      <para>First, we must make sure that the row with the parent organisation unit (for example the national level) is left out of the regular table. We do this by using a property specific to the Details band called Print when expression. To set a Print when expression, start by selecting the Detail band in the Report inspector, then edit the Print when expression in the properties panel.</para>
      <screenshot>
        <screeninfo>Select Detail 1 in the Report Inspector</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="50%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_11.jpg" format="JPEG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
      <screenshot>
        <screeninfo>Open the Expression Editor by clicking next to Print When Expression</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="50%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_12.jpg" format="JPEG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
      <para>The Expression editor window should now appear. What we must do is to create an expression that checks if the row being generated is the row with the organisation unit given as a parameter. The report table contains a column that we can use for this called organisation_unit_is_parent. To exclude the row with the parameter organisation unit, double click on organisation_unit_is_parent in the list to copy it to the expression area, then add .equals(&quot;No&quot;) at the end so that the code is:</para>
      <para>$F{organisation_unit_is_parent}.equals(&quot;No&quot;)</para>
      <para>This tells the report engine to only print table rows where the organisation unit is not the parent organisation unit.</para>
      <screenshot>
        <screeninfo>Code to skip parent organisation unit</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="90%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_14.jpg" format="JPEG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
    </section>
    <section>
      <title>Hiding other rows</title>
      <para>Using the expression editor it is also possible to exclude other rows from the table, in addition to the parent organisation unit as was explained above. In Ghana, for example, all regions have a «fake district» which is the name of the region in square brackets. This can also be excluded from the table using the Print when expression that was introduced above. To to this, follow the instructions above to bring up the Expression editor window. Then, we use Java expressions to test whether or not the row should be hidden.</para>
      <section>
        <title>Example - removing rows with organisation units starting with [</title>
        <para>Example - removing rows with organisation units starting with [</para>
        <para>($F{organisationunitname}.charAt( 0 ) != &apos;[&apos;)</para>
        <para>This makes the report skip any rows where the first character of the organisation unit name is [.</para>
        <para>It is also possible to combine several of these expressions. To do this we put the expressions in a parenthesis with the two characters &amp;&amp; in between. For example, to make a table that leaves both organisation units whose name starts with [ and the parent organisation unit, we can use the following expression:</para>
        <para>($F{organisationunitname}.charAt( 0 ) != &apos;[&apos;)&amp;&amp;$F{organisation_unit_is_parent}.equals(&quot;No&quot;)</para>
        <screenshot>
          <screeninfo>Combining expressions in the Expression editor</screeninfo>
          <mediaobject>
            <imageobject>
              <imagedata width="90%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_29.jpg" format="JPEG"/>
            </imageobject>
          </mediaobject>
        </screenshot>
      </section>
    </section>
    <section>
      <title>Showing the parameter organisation unit at the end of the table</title>
      <para>We have now made sure that the parameter organisation unit is not included in the table as a regular row. However, we often want to include it somewhere in the report. A good way to do this is to add it in the summary band so that it will appear below the table. The easiest way to do this is to copy all the text fields from the Detail band into the summary band, and then just edit the expression for the first column.</para>
      <itemizedlist>
        <listitem>
          <para>Select all the fields in the detail band and choose</para>
        </listitem>
        <listitem>
          <para>Copy from the Edit menu</para>
        </listitem>
        <listitem>
          <para>Click once on the Summary area</para>
        </listitem>
        <listitem>
          <para>Choose Paste from the Edit menu</para>
        </listitem>
        <listitem>
          <para>￼Position the new fields correctly</para>
        </listitem>
      </itemizedlist>
      <screenshot>
        <screeninfo>Select fields in the details band and copy them</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="90%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_16.jpg" format="JPEG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
      <screenshot>
        <screeninfo>Past fields into Summary band</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="90%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_25.jpg" format="JPEG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
      <screenshot>
        <screeninfo>Realign fields</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="90%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_26.jpg" format="JPEG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
      <para>The final step is to edit the expression of the first column to make sure that the correct organisation unit is displayed here. Open the Expression editor window and change the expression to $F{param_organisationunit_name}.</para>
      <screenshot>
        <screeninfo>Choose the parameter organisation unit</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="90%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_19.jpg" format="JPEG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
      <para>￼The report should now have all the «regular» organisation units as normal rows with their «parent» or «grand parent» at the bottom of the table.</para>
    </section>
  </section>
  <section>
    <title>Sorting</title>
    <para>Often you will be making reports where the first column is organisation unit names. However, it can be a problem that the list of organisation units are not sorted alphabetically. This can be fixed in iReport through a few simple steps.</para>
    <para>In the report inspector, right click on the name of the report (by default this is dpt) and select Edit query. </para>
    <screenshot>
      <screeninfo>Choose Edit Query</screeninfo>
      <mediaobject>
		<imageobject>
              <imagedata width="50%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_21.jpg" format="JPEG"/>
            </imageobject>
      </mediaobject>
    </screenshot>
    <para>A Report query window will appear. Click on the Sort options button.</para>
    <screenshot>
      <screeninfo>Choose Sort Options...</screeninfo>
      <mediaobject>
<imageobject>
              <imagedata width="90%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_22.jpg" format="JPEG"/>
            </imageobject>
      </mediaobject>
    </screenshot>
    <para>A Sorting window as show below will appear. Here, we can add our sorting options. Click the Add field button. Another small window will show up, with a drop down menu where you can choose Sort by organisationunitname to have the table sorted alphabetically by name.</para>
    <screenshot>
      <screeninfo>Choose Add</screeninfo>
      <mediaobject>
<imageobject>
              <imagedata width="70%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_23.jpg" format="JPEG"/>
            </imageobject>
      </mediaobject>
    </screenshot>
    <screenshot>
      <screeninfo>Choose sort parameter</screeninfo>
      <mediaobject>
<imageobject>
              <imagedata width="50%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_24.jpg" format="JPEG"/>
            </imageobject>
      </mediaobject>
    </screenshot>
    <para>Click OK - Close - OK to close the three windows. The table should now be sorted.</para>
  </section>
  <section>
    <title>Changing indicator/data element names</title>
    <para>By default, the reports from DHIS 2 uses the short names for indicators and data elements in reports and charts. In some cases these are not always very meaningful for third parties, but with some work they can be given custom names through iReport. This is useful for example if you are making a report with indicators as rows and periods as column, or for charts with indicators. </para>
    <screenshot>
      <screeninfo>Shortnames - before and after</screeninfo>
      <mediaobject>
<imageobject>
              <imagedata width="90%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_000.jpg" format="JPEG"/>
            </imageobject>
      </mediaobject>
    </screenshot>
    <para>To change the names of an indicator or data element, we have to edit its «expression» or formula, for example by right clicking the text box and choosing Edit expression to bring up the Expression editor. </para>
    <screenshot>
      <screeninfo>Choose Edit Expression</screeninfo>
      <mediaobject>
<imageobject>
              <imagedata width="50%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_32.jpg" format="JPEG"/>
            </imageobject>
      </mediaobject>
    </screenshot>
    <para>Next, we have to insert some Java code. In the following example, we will be replacing the shortname of three indicators with their proper names. The code searches for the shortname, and then replaces it with a proper name. </para>
    <screenshot>
      <screeninfo>Expression editor, showing replacing shortnames</screeninfo>
      <mediaobject>
<imageobject>
              <imagedata width="90%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_34.jpg" format="JPEG"/>
            </imageobject>
      </mediaobject>
    </screenshot>
    <para>($F{indicatorname}.equals(&quot;Bed Util All&quot;)) ? &quot;Bed Utilisation - All Wards&quot;:($F{indicatorname}.equals(&quot;Bed Util Mat&quot;)) ? &quot;Bed Utilisation - Maternity&quot;:($F{indicatorname}.equals(&quot;Bed Util Ped&quot;)) ? &quot;Bed Utilisation - Paediatric&quot;:$F{indicatorname}</para>
    <para>From this, we can see a pattern that is reusable for more general cases.</para>
    <itemizedlist>
      <listitem>
        <para>For each indicator or data element we want to change the name for, we need one line</para>
      </listitem>
      <listitem>
        <para>Each line is separated by a colon :</para>
      </listitem>
      <listitem>
        <para>We finish the expression with a «regular» line</para>
      </listitem>
    </itemizedlist>
    <para>Each line has the same format, where the red text is the shortname, the blue text is what we want to insert instead.</para>
    <screenshot>
      <screeninfo>Code for replacing shortnames. Shortname in red, new name in blue</screeninfo>
      <mediaobject>
<imageobject>
              <imagedata width="50%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_0.jpg" format="JPEG"/>
            </imageobject>
      </mediaobject>
    </screenshot>
    <para>The same expressions can be used for example when having indicator names along the category axis of a chart.</para>
  </section>
  <section>
    <title>Groups of tables</title>
    <para>There are cases when it can be useful to have several tables in one report. This can be done using Report groups. Using this functionality, one can for example create a report one table for each indicator, or one table of each organisation unit. In the following, we will go through the steps needed to make a report with three indicators, each represented in one table. It is important that the report table does not crosstab on indicators when we want to make groups of tables based on indicators. </para>
    <para>In our example, the .jrxml file downloaded from DHIS 2 will by default have one column for organisation unit and on for indicators (assuming we have chosen periods as the only crosstab dimension). We start by removing the indicator column, since this in not needed in our case, and realign the other fields to fit the report.</para>
    <screenshot>
      <screeninfo>Delete column</screeninfo>
      <mediaobject>
<imageobject>
              <imagedata width="50%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_36.jpg" format="JPEG"/>
            </imageobject>
      </mediaobject>
    </screenshot>
    <para>Next, we create out Report group. Go to the report insepctor, right click on the report name (dpt is the default) and choose Add Report Group. </para>
    <screenshot>
      <screeninfo>Add Report Group</screeninfo>
      <mediaobject>
<imageobject>
              <imagedata width="50%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_38.jpg" format="JPEG"/>
            </imageobject>
      </mediaobject>
    </screenshot>
    <para>A window will appear, with a report group wizard. Select a name for the group, in this case we choose «Indicator». In the drop down menu, we can select what columns in the report table we want the groups to be based on. So, if we wanted one table for each organisation unit, we would choose organisation unit name as the report object to group according to. However, since we are grouping by indicators in this example, we choose indicatorname. Then click next. </para>
    <screenshot>
      <screeninfo>Choose grouping parameter - here, indicators</screeninfo>
      <mediaobject>
<imageobject>
              <imagedata width="90%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_39.jpg" format="JPEG"/>
            </imageobject>
      </mediaobject>
    </screenshot>
    <para>The next step is to select whether or not we want a separate Group header and Group footer band for each report group. In this case, we choose to include both. Click Finish, and the group bands should appear in the report.</para>
    <screenshot>
      <screeninfo>Add group header/footer</screeninfo>
      <mediaobject>
<imageobject>
              <imagedata width="90%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_40.jpg" format="JPEG"/>
            </imageobject>
      </mediaobject>
    </screenshot>
    <para>If you upload and run the report, it will now create one table for each indicator. However, it will not look very good as there will be no header row over each table - only one header at the top of each page. Also, there is no indication as to which table is showing which indicator. In the following, we will fix this.</para>
    <para>Instead of having the title row in the column header, we can instead move it to the Group header. This will make the heading show up above each individual table. Furthermore, we can add a heading to each table with the name of the indicator. </para>
    <para>Move the column headers from the Column header band to the Indicator group header band.</para>
    <screenshot>
      <screeninfo>Move header row to column header</screeninfo>
      <mediaobject>
<imageobject>
              <imagedata width="90%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_41.jpg" format="JPEG"/>
            </imageobject>
      </mediaobject>
    </screenshot>
    <para>Next, add a text field to the Indicator group heading band, and edit it’s expression to display the indicator name.</para>
    <screenshot>
      <screeninfo>Add text field to use as heading</screeninfo>
      <mediaobject>
<imageobject>
              <imagedata width="90%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_42.jpg" format="JPEG"/>
            </imageobject>
      </mediaobject>
    </screenshot>
    <screenshot>
      <screeninfo>Edit text field expression to show indicator name</screeninfo>
      <mediaobject>
<imageobject>
              <imagedata width="90%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_44.jpg" format="JPEG"/>
            </imageobject>
      </mediaobject>
    </screenshot>
    <para>The report should now have three tables, one for each indicator. Each table will have a heading with the name of the indicator, and also a table header row.</para>
    <screenshot>
      <screeninfo>Example of finished report table</screeninfo>
      <mediaobject>
<imageobject>
              <imagedata width="90%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_45.jpg" format="JPEG"/>
            </imageobject>
      </mediaobject>
    </screenshot>
    <section>
      <title>Sorting and grouping</title>
      <para>When using grouping, some precautions must be taken with regards to sorting. Notably, when adding sorting parameters, whatever parameter is used as basis for the grouping must come first. Thus if you are grouping the report by indicator, and want sort the organisation units alphabetically, you have to choose to sort first by indicator, then by organisation unit name as shown below. For instructions on how to add sorting, see the sorting section above.</para>
      <screenshot>
        <screeninfo>Sorting by indicator and organisation unit name</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="70%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_59.jpg" format="JPEG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
    </section>
  </section>
  <section>
    <title>Charts</title>
    <para>By default, a 3D bar chart is included in the .jrxml file that is downloaded from DHIS 2. This is set up so that only data from the «parameter orgnisation unit» (often the parent or grand parent) is used. Usually, this is a good solution. Since it is the default, we will start by looking at bar charts, before looking at line charts.</para>
    <section>
      <title>Bar charts</title>
      <para>Bar charts are the default. To edit the chart, right click and choose Chart data.</para>
      <screenshot>
        <screeninfo>Choose Edit Chart Data</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="80%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_46.jpg" format="JPEG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
      <para>A window will appear. By default, the Filter expression is filled in so that only data for the parent organisation unit will be displayed. If for some reason you do not want this, simply delete the text in the text box. To continue, click the details tab.</para>
      <screenshot>
        <screeninfo>Select the Details tab</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="80%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_47.jpg" format="JPEG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
      <para>Under details, you see the list of series for the chart. By default, one series is created per crosstab column. In this case, we are looking at data with four quarters along the crosstab dimension.</para>
      <screenshot>
        <screeninfo>List of data series</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="80%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_48.jpg" format="JPEG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
      <para>To make changes to any of the series, select it and click modify. Another window will appear where there are four areas that can be edit. The three first are required, but it is sufficient to add an empty quote («») in one of the first two.</para>
      <screenshot>
        <screeninfo>The data series editor</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="80%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_49.jpg" format="JPEG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
      <para>The first box is a text field where the name of the series can be inserted or edited. This is the field that will be used to fill the text in the legend box (shown below).</para>
      <screenshot>
        <screeninfo>Chart legend</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="90%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_50.jpg" format="JPEG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
      <para>However, if you want to have the name of each bar along the x-axis of the chart instead of using the legend, this can be done by adding whatever text you want to present in the Category expression field. </para>
      <para>If you add a good description in the Category expression area, you can leave out the legend box. This is done in the Report properties panel of iReport, where you can also edit many other details of the chart.</para>
      <screenshot>
        <screeninfo>Checkbox to show/hide chart legend</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="50%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_51.jpg" format="JPEG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
      <para>We can also add a title to the chart, for example the name of the indicator. This is also done in the Chart properties panel, under Title expression.</para>
      <screenshot>
        <screeninfo>Edit chart title</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="50%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_55.jpg" format="JPEG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
      <para>The Expression editor window will appear, where you can enter the title. Note that the title must be in quotes, as shown below.</para>
      <screenshot>
        <screeninfo>Expression editor</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="90%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_56.jpg" format="JPEG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
      <para>Below, you can see what effect the above changes have had to make the chart more clean and readable.</para>
      <screenshot>
        <screeninfo>Chart - before</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="90%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_53.jpg" format="JPEG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
      <screenshot>
        <screeninfo>Chart - after</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="90%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_54.jpg" format="JPEG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
    </section>
    <section>
      <title>Line charts</title>
      <para>Line charts can be useful in many circumstances. However, to make line charts the report data (report table) must be suited for it. Thus if you want to make a line chart, it is important that the report table does not have periods in the crosstab dimension. Examples where this is useful is if you are making a report for a single organisation unit with one or more indicators, or if you are making a report with one indicator and one or more organisation units.</para>
      <para>Below, we will go though the steps needed to make a report with a line chart showing the development of three indicators over one year, for one organisation unit. We start by making a report table with the choices shown below:</para>
      <screenshot>
        <screeninfo>Report table - crosstab dimensions</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="50%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_57.jpg" format="JPEG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
      <screenshot>
        <screeninfo>Report table - periods and parameters</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="80%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_60.jpg" format="JPEG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
      <para>When we open the resulting .jrxml-file in iReport, the default line chart is included. Since we want to make a line chart, we delete this chart and drag a new chart element into the report from the Palette panel.</para>
      <screenshot>
        <screeninfo>Delete the default chart</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="90%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_61.jpg" format="JPEG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
      <screenshot>
        <screeninfo>Drag in new chart element</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="90%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_62.jpg" format="JPEG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
      <para>As soon as we drag the Chart element into the report, a window will appear. We choose the Line chart, as shown below. </para>
      <screenshot>
        <screeninfo>Choose Line chart</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="70%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_63.jpg" format="JPEG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
      <para>A chart wizard will appear. Click next in the first step, then Finish in the next - we will add the data later.</para>
      <screenshot>
        <screeninfo>Choose Next</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="80%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_64.jpg" format="JPEG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
      <screenshot>
        <screeninfo>Choose Finish</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="80%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_65.jpg" format="JPEG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
      <para>Next, adjust the size and position of the chart in your report. Then, we will add one data series for each of our three indicators. Right-click on the chart and choose Chart data. If you are making a chart with one indicator and several organisation units, you probably want to make a filter expression so that only data from the paramter/parent organisation unit is used in the chart. To do this, add this line to the Filter expression area:</para>
      <para>$F{organisation_unit_is_parent}.equals(&quot;Yes&quot;)</para>
      <para>In our example, we only have on organisation unit, so this is not necessary. Next, click the details tab to see a list of the series in the chart. For now, this list is empty, but we will add one series for each of our three indicators. To add a series, click the Add button.</para>
      <screenshot>
        <screeninfo>Choose the Details tab</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="70%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_66.jpg" format="JPEG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
      <screenshot>
        <screeninfo>Choose Add</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="70%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_67.jpg" format="JPEG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
      <para>In the window that appears, enter the name of the first of the indicators in the Series expression window. Remember to put the name in quotes.  In the category expression (along the x-axis) we want the months, so we use the button next to the field to open the Expression editor and add periodname. </para>
      <screenshot>
        <screeninfo>Edit the category expression</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="70%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_69.jpg" format="JPEG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
      <screenshot>
        <screeninfo>Choose periodname as the expression</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="70%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_68.jpg" format="JPEG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
      <para>In the value expression, we add the actual data values for our first indicator. Use the Expression editor again to do this. When we are finished, the window should look like the one below, only with different names according to the indicator. </para>
      <screenshot>
        <screeninfo>The finished category series</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="70%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_70.jpg" format="JPEG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
      <para>You can then Click OK to close the window. Follow the same steps to add a series for the other indicators. </para>
      <screenshot>
        <screeninfo>Chart details after adding three series</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="70%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_71.jpg" format="JPEG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
      <para>Close the window, and the data for the line chart should be ready. However, some additional adjustments might be needed - most of these can be found in the Line chart properties panel. For example, when making a month by month chart as we have in example, there is often not enough space for the month names along the category axis. This can be fixed by rotating the labels by for example -40 degrees, by using the property Category Axis Tick Label Rotation.</para>
      <screenshot>
        <screeninfo>Changing the appearance of the category labels</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="50%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_72.jpg" format="JPEG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
      <para>Many other options are available to give the chart the desired look.</para>
      <screenshot>
        <screeninfo>The finished line chart</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="90%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_73.jpg" format="JPEG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
    </section>
  </section>
</chapter>
