<?xml version="1.0" encoding="UTF-8"?>
  
  <!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN" "http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd" []>

<section>
  <title>Web based mobile solution</title>
  <para>The web based solution has two distinct two parts: Facility reporting, for data entry and
    reporting of regular DHIS2 aggregate data, and Activity reporting, for supporting individual
    activity reporting with the Community module.</para>

  <para>The solution relies on the mobile phone having a data connection available (i.e.
    GPRS, Edge, 3G), over which it communicates with a DHIS2 instance being publicly
    available on the internet, as any other web client. The application downloads the forms to be reported from the
    server, and the forms can therefore be updated without installing a new application. This is also a crucial feature 
    for community reporting, which relies on regularly downloading activity plans from the server.
    </para>
  <section>
    <title>Data connection availability</title>
    <para>Data connection availability can be a problem in many of the contexts where DHIS2 mobile
      reporting would otherwise be a good solution for getting data directly into DHIS2. If that is
      the case for you, you might want to consider trying the SMS based solution for now.
      But keep in mind that even though a data connection is currently required for communication between
      the server and the mobile phone, it is only required when initializing or updating the mobile
      application and when sending reports to the server. The phone stores all entered data locally,
      so it it can work fine with only temporary access to a data connection on a regular basis.
    </para>
  </section>
  <section>
    <title>Server side setup for facility reporting</title>
    <para>The server side component of the web based solution is just regular web application functionality, 
    and it is included in the general build of DHIS2 (the web api itself is in the dhis-web-api module)</para>
    <itemizedlist>
      <title>To try out the facility reporting, perform these steps on the
        server</title>
      <listitem>
        <para>
          Set the "Available for Mobile Reporting" flag for the data sets you want reported:
          Under <emphasis>Maintenance, DataSet</emphasis>, edit the data set you want, 
          mark the “Available for Mobile Reporting” check box and save.
        </para>
      </listitem>
      <listitem>
        <para>Make sure the user that you want to log in as is associated to one (and
          only one)
          organizational unit has the "mobile" datasets assigned.</para>
      </listitem>
      <listitem>
        <para>That was all, go see if you can get the mobile working.</para>
      </listitem>
    </itemizedlist>
  </section>
  <section>
    <title>A little detail</title>
    <para>Though the previous steps is all that should be needed for testing the solution,
      there are of course some more things you want to know about the server setup.</para>
    <section>
      <title>The mapping of data sets to form layout on the phone</title>
      <para>By default a data set is mapped to one large form on the phone.
        If the data set is divided into sections, each section is a form page.
        If a data element has more than one category option combo it will be displayed as a heading with the combos
        following.</para>

      <table border="2" >
      <caption>Names for form elements are derived in the following way</caption>
      <tr><td>Form name</td><td>Data set</td><td>ShortName if it exists, otherwise name</td></tr>
      <tr><td>Page name</td><td>Section</td><td>Section name (or form name if no sections)</td></tr>
      <tr><td>Question name (heading if combos)</td><td>Data element </td><td>alternativeName if it exists, otherwise name</td></tr>
      <tr><td>Question name if combos</td><td>Category option combo</td><td>name</td></tr>
      </table>
    </section>
    <section>
      <title>Sorting of forms</title>
      <para>By default, data elements will be sorted according to the global sorting assigned in DHIS2. If sections are used, their sorting will be used.
      In some cases, when sections are not used, a data element might be used in multiple data sets, and conflict in the way it should be sorted in individual data sets. A work around for this situation is to wrap the whole dataset in one section (note that this will only work if the data elements have the same category option combo)</para>
    </section>
    <section>
      <title>Versioning of data sets</title>
      <para>To make it possible to compare and update the data sets on the mobile phone with the 
        version on the server, data sets are automatically versioned when you edit the data set structure.</para>
      <itemizedlist>
        <title>Changes that currently trigger a new data set version</title>
        <listitem><para>Create DataSet</para></listitem>
        <listitem><para>Edit DataSet</para></listitem>
        <listitem><para>Create/edit/delete Section in DataSet</para></listitem>
        <listitem><para>Sort Section Order</para></listitem>
        <listitem><para>Update DataElement (affect many related DataSets)</para></listitem>
        <listitem><para>Delete DataElement (affect many related DataSets)</para></listitem>
        <listitem><para>Edit DataElement Category</para></listitem>
        <listitem><para>Edit DataElement Category Combo</para></listitem>
      </itemizedlist>
    </section>
    <section>
      <title>Language support</title>
      <para>Language support for the form contents is not fully supported yet, as of the current
        version (?)</para>
    </section>
  </section>
  <section>
    <title>Mobile application setup</title>
    <para></para>
    <section>
      <title>Installation and initialization</title>
      <para>....
    </para>
    </section>
  </section>
</section>
