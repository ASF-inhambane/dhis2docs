<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN"
                      "http://www.docbook.org/xml/4.4/docbookx.dtd">
<book>
    <bookinfo>
        <title>MyDatamart User Manual</title>
        <!--        <releaseinfo><?eval ${project.version}?></releaseinfo>-->
        <releaseinfo>1.0</releaseinfo>
        <keywordset>
            <keyword>DHIS2</keyword>
            <keyword>HMIS</keyword>
            <keyword>aggregate data</keyword>
            <keyword>Health Management Information System</keyword>
            <keyword>Integrated data repository</keyword>
            <keyword>Health Information System</keyword>
        </keywordset>
        <copyright>
            <year>2006-2011</year>
        </copyright>
        <author>
            <firstname>Dhis2</firstname>
            <surname>Documentation Team</surname>
        </author>
        <legalnotice>
            <formalpara id="warranty">
                <title>Warranty:</title>
                <para> THIS DOCUMENT IS PROVIDED BY THE AUTHORS &apos;&apos;AS IS&apos;&apos; AND
                    ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
                    WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
                    DISCLAIMED. IN NO EVENT SHALL THE AUTHORS OR CONTRIBUTORS BE LIABLE FOR ANY
                    DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
                    (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
                    LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
                    ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
                    (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
                    MANUAL AND PRODUCTS MENTIONED HEREIN, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
                    DAMAGE.</para>
            </formalpara>
            <formalpara id="license">
                <title>License:</title>
                <para> Permission is granted to copy, distribute and/or modify this document under
                    the terms of the GNU Free Documentation License, Version 1.3 or any later
                    version published by the Free Software Foundation; with no Invariant Sections,
                    no Front-Cover Texts, and no Back-Cover Texts. A copy of the license is included
                    in the source of this documentation, and is available here online:<ulink
                        url="http://www.gnu.org/licenses/fdl.html">
                        http://www.gnu.org/licenses/fdl.html</ulink>.</para>
            </formalpara>
        </legalnotice>
        <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="../build.properties"
            encoding="UTF-8"/>
    </bookinfo>
    <chapter>
        <title>Background</title>
        <para>The Mydatamart tool was created to address a changing paradigm in the deployment of
            DHIS2. In the past, going back to the days even before DHIS was a web application, the
            typical data flows of the system, as installed in a district office, was between
            components which were closely located to one another. The DHIS application was used to
            provide a user interface to a database, which stored all the data and metadata for the
            application. In many settings the user interface, the application and the database might
            even be on the same computer. In other settings these three components might exist
            seperately on a small Local Area Network (LAN) within the district office.</para>
        <para>The user would interact with the database in two different ways. In the normal flow of
            working with DHIS2 she would work through the web interface and the DHIS2 web
            application would take care of updating the database in the background. When analyzing
            data, the typical approach is to create pivot tables using Microsoft Excel, and
            configure Excel to fetch the data required by configuring an ODBC connection which
            points to the database. These flows of data are illustrated in <xref
                linkend="dataflow_orig"/> below.</para>
        <figure id="dataflow_orig">
            <title>Data flows using DHIS2</title>
            <graphic align="center" width="4in"
                fileref="resources/images/mydatamart/dataflow_orig.png"/>
        </figure>
        <para>It is important to understand that the quantity of data being transported between the
            database and Excel pivot table (data flow 3 in the figure) can be quite large. By and
            large this is acceptable so long as the user is working on the same computer as the
            database or at least on the same high speed LAN. But the requirement for the user to be
            able to pull large amounts of data from the database in order to update pivot tables
            imposes a severe constraint on the possible DHIS2 deployment options. One of the
            benefits of a web application is that the application server does not need to be
            physically present in the district office. Having everything co-located creates an
            additional burden of hardware and software maintenance which distracts from the core
            function of the district office. Where the district office has reasonable internet
            connectivity it is preferable to be able to host the DHIS2 web application at some
            central location within a data centre where it can be professionally managed by system
            administrators with the requisite skills.</para>
        <para>The challenge that is introduced by this type of deployment is that we can no longer
            rely on users analyzing their data by performing frequent and voluminous updates of
            their pivot tables from the back end database. In fact, in a properly secured
            deployment, the district user will not be able to access the database at all. All
            interaction with DHIS2 would be through the web interface to the application.</para>
        <para>Mydatamart was created to address this problem. With Mydatamart, the data that is
            required to be analyzed in pivot tables is pulled incrementally from the dhis database
            via the dhis2 webserver and stored locally in a small but efficient local database. This
            database makes use of the widely deployed Sqlite database engine. This new dataflow is
            shown in red in <xref linkend="dataflow_new"/>.</para>
        <figure id="dataflow_new">
            <title>Using a local datamart</title>
            <graphic align="center" width="4in"
                fileref="resources/images/mydatamart/dataflow_new.png"/>
        </figure>
        <para>With the data available locally, pivot tables in the district office can now be
            configured to use ODBC connections to the local Sqlite database instead of the remote
            database server.</para>

    </chapter>
    
    <chapter>
        <title>Installation</title>
        <para>Installation of Mydatamart has been made as simple as possible. The application itself
            is a self-contained executable which doesn't require any additional installation
            procedure. If you have the executable then it is ready to run. If you are going to use
            Microsoft Excel to create and use pivot tables linked to your local datamart, then you
            do also need to install the Sqlite3 ODBC driver. In addition, power users might also
            want to make use of a database GUI application to inspect ot manipulate the datamart
            files directly. There are a number of freely available applications for viewing sqlite3
            databases - we highly recommend a program called sqlitestudio.</para>
        <table id="software">
            <title>Software and where to get it</title>
            <tgroup cols="3">
                <thead>
                    <row>
                        <entry>Software</entry>
                        <entry>Purpose</entry>
                        <entry>Download</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry>Mydatamart</entry>
                        <entry>Desktop tool for managing local datamart</entry>
                        <entry>The latest version can always be found at
                            http://www.dhis2.org</entry>
                    </row>
                    <row>
                        <entry>Sqlite3 ODBC driver</entry>
                        <entry>Required for Excel to be able to link to datamart files.</entry>
                        <entry>The home page is http://www.ch-werner.de/sqliteodbc/. You should
                            download the file sqliteodbc.exe. For convenience a version can also be
                            found at http://www.dhis2.org.</entry>
                    </row>
                    <row>
                        <entry>Sqlitestudio</entry>
                        <entry>This is not required but may be useful for power users to inspect the
                            sqlite3 database files.</entry>
                        <entry>The home page is http://sqlitestudio.one.pl/. Check here for most
                            current version. For convenience A version can also be found here
                            http://www.dhis2.org.</entry>
                    </row>
                </tbody>
            </tgroup>

        </table>
        <para>The following provides a list of step by step instructions to get started: <orderedlist>
                <listitem>
                    <para>Download the file sqliteodbc.exe from one of the locations indicated
                        above</para>
                </listitem>
                <listitem>
                    <para>Double-click on the downloaded file to install the driver. Follow the on
                        screen instructions and accept all defaults.</para>
                </listitem>
                <listitem>
                    <para>Download the file mydatamart.exe and place it somewhere visible on your
                        desktop. The icon should be a small blue feather as indicated in <xref
                            linkend="icon"/> below.</para>
                    <figure id="icon">
                        <title>Mydatamart desktop icon</title>
                        <graphic align="center" width="2in"
                            fileref="resources/images/mydatamart/icon.png"/>
                    </figure>
                    <para>The application can be launched by double-clicking on this icon.</para>
                </listitem>
            </orderedlist>
        </para>
    </chapter>

    <chapter>
        <title>The Mydatamart application</title>
        <para>The purpose of the Mydatamart application is to manage a local datamart store which is
            populated by downloading small chunks of data from the central DHIS2 web application. It
            also manages the details of ODBC connection parameters required to link Excel workbooks
            to your data.</para>
        <para>The simplest way to start mydatamart.exe is to double-click on the icon on your
            desktop. The application should open and show a window like <xref linkend="first"/>
            below:</para>
        <figure id="first">
            <title>Mydatamart on first open</title>
            <graphic align="center" width="3in" fileref="resources/images/mydatamart/first.png"/>
        </figure>
        <para>All of the functionality of mydatamart is available through the menu items in the
            upper menu bar. Some of the more commonly used functions are also available through the
            image button bar immediately below the menu. If you hover your mouse slowly over these
            buttons a tooltip window should show the functions of each.</para>
        <section>
            <title>Creating a new datamart</title>
            <para>Now the main purpose of mydatamart is to manage your personal datamart files so
                the first thing you will need to do is to create a new datamart. You can create a
                new datamart either through the File->New menu option or by pressing the button with
                the blue cross. When you create this new datamart you will be prompted for a file
                name. The extension .dmart will be appended automatically to the name. Give some
                thought to how and where you are going to store this file as it will soon be full of
                valuable data so you really do need to look after it. You can create a backup at any
                time by simply making a copy of this file, eg. onto a USB memory stick.</para>
            <note>
                <para>The .dmart file is actually an sqlite3 database file which you can also open
                    and view or edit with any sqlite3 capable tool, such as sqlitestudio.</para>
            </note>
            <para>When you create the new datamart, the application will present a dialog like <xref
                    linkend="new"/>.</para>
            <figure id="new">
                <title>Creating a new datamart</title>
                <graphic align="center" width="3in" fileref="resources/images/mydatamart/new.png"/>
            </figure>
            <para>The first thing you must do is to establish a connection with your dhis server. To
                do this enter the full url (including http://) of the dhis server into the box
                labelled <emphasis>URL</emphasis>. Then enter your online dhis user name and
                password. Your password will not be saved anywhere on your machine. To login press
                the button labelled <emphasis>Login</emphasis>. If the login was successful you will
                be rewarded with a green tick icon next to the login button.</para>
            <figure id="loggedin">
                <title>Logging in to dhis2 server</title>
                <graphic align="center" width="3in"
                    fileref="resources/images/mydatamart/loggedin.png"/>
            </figure>

        </section>
        <section>
            <title>Populating the datamart with metadata</title>
            <para>The local datamart is designed to store aggregated data values from dataelements
                and indicators in the online DHIS2 application. But before you can do this, you must
                first populate the local datamart with <emphasis>metadata</emphasis> from the remote
                dhis2.</para>
            <para>Metadata refers to the parts of the database which give the data values meaning.
                This includes: <itemizedlist>
                    <listitem>
                        <para>Organisation units and hierarchy;</para>
                    </listitem>
                    <listitem>
                        <para>Dataelement and Indicator names;</para>
                    </listitem>
                    <listitem>
                        <para>Datavalue disaggregations (categories and categoryoptions);</para>
                    </listitem>
                    <listitem>
                        <para>Various groups and groupsets.</para>
                    </listitem>
                </itemizedlist> This information is required to work with pivot tables and to select
                important parameters relating to your organisation unit. </para>
            <para>Fortunately populating with metadata is a straightforward, if time consuming,
                operation. The easiest way to load metadata from DHIS2 is to press the toolbar
                button with the <inlinegraphic fileref="resources/images/mydatamart/hierarchy.png"/>
                image. It can also be done via the "Datamart->Load metadata from dhis" menu
                option.</para>
            <para>The Mydatamart application will then contact the remote DHIS2 server and download,
                transform and save the metadata into the local database.</para>
            <note>
                <para>Currently the transform part of the operation is quite slow. Expect it to take
                    as long as ten minutes. During this time you cannot work with the application so
                    you have to be patient. The reason for the long time is that it must process all
                    of the orgunits in the dhis hierarchy, which for many countries can be quite
                    large. In future editions of Mydatamart we will improve on this by cutting down
                    the number of orgunits to be processed.</para>
            </note>
            <para>Once the metadata download is complete the user will be returned to the Settings
                interface where she can proceed to enter information about her organisation unit and
                the level of analysis to be used. This configuration is covered in the following
                section.</para>
        </section>
        <section>
            <title>Choosing Organisation unit and analysis level</title>
            <para/>
            <figure id="analysis_level">
                <title>Setting analysis parameters</title>
                <graphic align="center" width="3in"
                    fileref="resources/images/mydatamart/analysis_level.png"/>
            </figure>
        </section>
        <section>
            <title>Downloading data</title>
            <para/>
            <figure id="download">
                <title>Downloading data</title>
                <graphic align="center" width="3in"
                    fileref="resources/images/mydatamart/download.png"/>
            </figure>
        </section>
        <section>
            <title>Creating new pivot tables</title>
            <para/>
        </section>
        <section>
            <title>Linking to shared pivot tables</title>
            <para/>
        </section>
        <section>
            <title>Troubleshooting</title>
            <para/>
        </section>
    </chapter>
    <chapter>
        <title>Summmary notes</title>
        <para/>
    </chapter>

</book>
